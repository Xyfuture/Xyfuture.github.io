<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>cpp相关知识复习 - Xyfuture's Blog</title><meta name=Description content="This is my cool site"><meta property="og:title" content="cpp相关知识复习"><meta property="og:description" content="Linux 进程分段 global & static variable c++ - When are static and global variables initialized? - Stack Overflow 全局变量和static变量都拥有static lifetime(静态的生命周期，生命周期同整个进程相"><meta property="og:type" content="article"><meta property="og:url" content="http://xyfuture.github.io/posts/%E9%87%8D%E6%8B%BEcpp/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-20T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-20T00:00:00+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="cpp相关知识复习"><meta name=twitter:description content="Linux 进程分段 global & static variable c++ - When are static and global variables initialized? - Stack Overflow 全局变量和static变量都拥有static lifetime(静态的生命周期，生命周期同整个进程相"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://xyfuture.github.io/posts/%E9%87%8D%E6%8B%BEcpp/><link rel=prev href=http://xyfuture.github.io/posts/xmake%E4%BD%93%E9%AA%8C/><link rel=next href=http://xyfuture.github.io/posts/xmake%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"cpp相关知识复习","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/xyfuture.github.io\/posts\/%E9%87%8D%E6%8B%BEcpp\/"},"genre":"posts","wordcount":1788,"url":"http:\/\/xyfuture.github.io\/posts\/%E9%87%8D%E6%8B%BEcpp\/","datePublished":"2022-08-20T00:00:00+00:00","dateModified":"2022-08-20T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"xyfuture"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Xyfuture's Blog">Xyfuture's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Xyfuture's Blog">Xyfuture's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">cpp相关知识复习</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=about title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>xyfuture</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-08-20>2022-08-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1788 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#链接的顺序>链接的顺序</a></li></ul></nav></div></div><div class=content id=content><h1 id=linux-进程分段>Linux 进程分段</h1><h1 id=global--static-variable>global & static variable</h1><blockquote><p><a href=https://stackoverflow.com/questions/17783210/when-are-static-and-global-variables-initialized target=_blank rel="noopener noreffer">c++ - When are static and global variables initialized? - Stack Overflow</a></p></blockquote><p>全局变量和static变量都拥有static lifetime(静态的生命周期，生命周期同整个进程相同,这些变量可以被称为static objects)，他们在初始化时有一些性质。在cpp中针对global或者static变量有3种初始化的方式。这3种方式分别是 1. Zero initialization 2. Static initialization 3. Dynamic initialization。</p><p>initialization的过程是在main函数执行前就确定的，在cpp中，我们是允许在main函数之前执行一些代码的(貌似c不支持这个feature)。首先只声明的变量做zero initialization，被放置到bss段(数据全为0的一个段)，然后针对赋常量的static objects由编译器进行static initialization处理，放置在data段(放已初始化static objects)，这个过程是离线完成的，data段里直接存着值。最后对于需要执行一段代码才能初始化的static objects，进行dynamic initialization，其放置到bss段，然后在main函数之前执行初始化程序。</p><p>多个文件中可以独立设置自己的gobal variable，这些global variable仅能被文件内的函数访问，尽管他们确实在bss段或者data段，此外global variable在多个文件中不能重名，他们是strong symbol，可以使用external关键词引入外部文件的global variable。</p><p>不同文件中global variable会在link阶段汇入程序，但是目前不能保证global variable 在dynamic initialization时的顺序，因此可能会产生bug，最好不要相互依赖(Static Initialization Order Fiasco)</p><blockquote><p>可以看看supersim实现的libfactory，非常骚的操作，通过全局变量来实现注册功能，之后就可以提供工厂函数功能。</p></blockquote><h1 id=继承关系>继承关系</h1><h1 id=static>static</h1><p>父类中定义的static member在子类中不会被重新分配空间，子类中调用还是修改父类的static member。这个貌似可以用来实现部分实现pytorch中注册进module的效果。</p><h1 id=inline>inline</h1><blockquote><p><a href=https://www.zhihu.com/question/311420548/answer/592941203 target=_blank rel="noopener noreffer">参考链接</a></p></blockquote><p>C++ 11之后添加了新的特性，更加方便实现header only的库。</p><p>inline最开始的时候主要是提示给编译器用来将该函数进行内联展开提升性能的，但是目前来说内联函数的实现主要依赖于编译器的实现了，有时候对部分函数不加inline照样展开，有时候加了inline也不展开。</p><p>现在inline主要用来标识一个弱符号，cpp正常对于一个符号(函数)是不允许多次进行实现的，但是采用inline之后表示这是一个弱符号，就可以多次实现，但最后链接的时候只会使用同一份实现(从多个实现中随机选择一个，实际上一般多个实现都是一样的)，这样就能方便很多header only的库进行实现，因为header only库中有多次的实现的符号也能正常进行链接。</p><p>此外template本身是支持弱符号链接的，不需要单独使用inline关键词了。template每次实例后其实都是弱符号的，最后链接的时候从相同类型的实列中随机选择一个实现的二进制代码(实际上都是一样的)。</p><h1 id=template>template</h1><h1 id=const>const</h1><h1 id=编译链接>编译链接</h1><blockquote><p>结合xmake的流程简单记录一下</p></blockquote><h2 id=链接的顺序>链接的顺序</h2><p>静态链接的时候是有顺序要求的，遇到一个obj文件时，后从他开始从左到右开始搜索lib文件和obj文件，如果其中有未知符号对应的实现就进行链接操作，这个从左到右的操作就要求我们把依赖其他库的lib或者obj放到前面。下面用个例子说一下。</p><p>比如A.obj 依赖a.lib,但是a.lib又依赖b.lib因此编译的时候要把a.lib写在前面</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>g++ -la -lb -o a.exe A.obj <span class=c1>#不通过，A.obj 依赖a.lib,应该把A.obj放前面</span>
</span></span><span class=line><span class=cl>g++ -o a.exe A.obj -lb -la <span class=c1>#不通过，a.lib依赖b.lib，应该把a.lib放前面</span>
</span></span><span class=line><span class=cl>g++ -o a.exe A.obj -la -lb <span class=c1>#通过</span>
</span></span></code></pre></div><p>动态链接一般能自动处理这个事情，不过一般还是主要用静态链接。</p><p>在xmake中更改<code>add_package()</code>的顺序就可以更改链接时的顺序。或者手动改cmakelist也可以改变链接的顺序。</p><h1 id=function--bind>function & bind</h1><blockquote><p><a href=https://blog.csdn.net/songsong2017/article/details/103810309 target=_blank rel="noopener noreffer">参考</a></p></blockquote><p>cpp里面增强的函数指针功能。可以把一个函数用指针传出去。</p><p>bind则能给一个函数直接绑定上几个参数，比如类里面的this，还能借助placeholder实现参数位置的调换。</p><p>直接看几个例子吧</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;functional&gt;</span><span class=cp>
</span></span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-08-20</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://xyfuture.github.io/posts/%E9%87%8D%E6%8B%BEcpp/ data-title=cpp相关知识复习><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://xyfuture.github.io/posts/%E9%87%8D%E6%8B%BEcpp/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://xyfuture.github.io/posts/%E9%87%8D%E6%8B%BEcpp/ data-title=cpp相关知识复习><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://xyfuture.github.io/posts/%E9%87%8D%E6%8B%BEcpp/ data-title=cpp相关知识复习><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=http://xyfuture.github.io/posts/%E9%87%8D%E6%8B%BEcpp/ data-title=cpp相关知识复习><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/xmake%E4%BD%93%E9%AA%8C/ class=prev rel=prev title=xmake体验><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>xmake体验</a>
<a href=/posts/xmake%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8/ class=next rel=next title=xmake基础使用>xmake基础使用<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=about target=_blank>xyfuture</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:100},comment:{},search:{highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:50}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>